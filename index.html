<!-- Chosen Palette: Professional Blue & Calm Neutrals -->
<!-- Application Structure Plan: A two-part SPA structure. The first part is a static, well-formatted knowledge base detailing the tariff regulations (TVAöD/TVöD) for clarity. The second part is a task-oriented interactive calculator that follows a linear user flow: 1. Input Base Data -> 2. Input Shift/Hour Data -> 3. View Calculated Results & Visualization. This separation of concerns (information vs. tool) and guided flow was chosen to reduce cognitive load and allow users to either just read the rules or directly use the calculator without being overwhelmed. -->
<!-- Visualization & Content Choices: Legal Text -> Goal: Inform -> Method: Structured HTML blockquotes & lists -> Interaction: None (static reference) -> Justification: Provides clear, non-interactive legal context. | Allowance Calculation -> Goal: Calculate & Analyze -> Method: Interactive input fields, dynamic text outputs, and a donut chart (Chart.js/Canvas) -> Interaction: Real-time updates on input -> Justification: The donut chart effectively visualizations the composition of the total allowance, showing which types of work contribute most to the extra pay. All interactions directly support the primary task of calculation. -->
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 1. ÜBERSCHRIFT ANGEPASST -->
    <title>Zahlungen für Auszubildende nach geltendem Recht im öffentlichen Dienst</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #333;
        }
        .card {
            background-color: #FFFFFF;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 450px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .btn {
            background-color: #A0522D;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }
        .btn:hover {
            background-color: #8B4513;
        }
        h1, h2, h3 {
            color: #8B4513;
        }
        /* Custom styles for results */
        .result-highlight {
            border: 1px solid #10B981; 
            background-color: #ECFDF5; 
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
        }
        .result-highlight-text {
            color: #047857;
        }
        .total-highlight {
            background-color: #D1FAE5;
            border-left: 4px solid #059669; 
            border-radius: 0 0.5rem 0.5rem 0;
            padding: 1rem;
        }
        /* Neue Styles für die Zulagen-Info-Boxen */
        .info-box {
            background-color: #f3f4f6; /* light gray, like the blockquote under B */
            border-left: 4px solid #6366f1; /* Indigo-500 for distinction */
            border-radius: 0 0.5rem 0.5rem 0;
            padding: 1rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body>

    <main class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="text-center mb-10">
            <!-- 1. ÜBERSCHRIFT ANGEPASST -->
            <h1 class="text-3xl md:text-4xl font-bold mb-2">Zahlungen für Auszubildende nach geltendem Recht im öffentlichen Dienst</h1>
            <p class="text-lg text-gray-600">Berechnung basierend auf dem TVAöD / TVAöD-BBIG und TVöD / -V (VKA)</p>
        </header>

        <section id="legal-basis" class="card">
            <h2 class="text-2xl font-bold mb-4">Rechtliche Grundlagen & Paragraphen</h2>
            <div class="space-y-4">
                
                <!-- Tarifliche Basis (3. ERWEITERT) -->
                <blockquote class="mt-4 p-3 bg-indigo-50 border-l-4 border-indigo-400 rounded-r-lg">
                    <p class="font-bold text-indigo-700">Tarifliche Basis: TVAöD / TVAöD-BBIG und TVöD / -V (VKA)</p>
                    <p class="text-sm mt-2 text-gray-700">
                        Das Ausbildungsverhältnis unterliegt u. a. den Bestimmungen des <strong>TVöD-V & TVAöD /-BBIG.</strong> Die Anwendung des <strong>TVAöD-BBIG</strong> ist in <strong>§ 1 TVAöD-BBIG Abs. 1 Buchstabe a</strong> sichergestellt. Die Regelungen zu den Zeitzuschlägen und Schichtzulagen verweisen sinngemäß entsprechend von <strong>§ 8a TVAöD-BBIG</strong> auf die Vorgaben des <strong>§ 8 TVöD (VKA).</strong> Die hier aufgeführten Sätze gelten sinngemäß für Azubis im öffentlichen Dienst (VKA). Die weiteren unten genannten Punkte D/E/F/G sind seperat mit Verweisen belegt.
                    </p>
                </blockquote>
                
                <h3 class="text-lg font-semibold mt-4">A. Zeitzuschläge (Prozentual zum Stundenlohn gemäß § 8 Abs. 1 TVöD)</h3>
                <ul class="list-disc list-inside space-y-2 mt-2 ml-4 text-gray-700">
                    <li><strong>Feiertagsarbeit</strong> (ohne Freizeitausgleich, § 8 Abs. 1 Satz 2 Buchst. f): <strong>135%</strong> des Stundenlohns (Zeitraum: <strong>ganztägig (00:00 bis 24:00 Uhr)</strong>).</li>
                    <li><strong>Sonntagsarbeit</strong> ( § 8 Abs. 1 Satz 2 Buchst. d): <strong>25%</strong> des Stundenlohns (Zeitraum: <strong>ganztägig (00:00 bis 24:00 Uhr)</strong>).</li>
                    <li><strong>Heiligabend/Silvester</strong> ( § 8 Abs. 1 Satz 2 Buchst. e): <strong>35%</strong> des Stundenlohns (Zeitraum: <strong>ab 06:00 Uhr</strong>).</li>
                    <li><strong>Nachtarbeit</strong> ( § 8 Abs. 1 Satz 2 Buchst. b): <strong>20%</strong> des Stundenlohns (Zeitraum: <strong>21:00 bis 06:00 Uhr</strong>).</li>
                    <li>
                        <strong>Überstunden</strong> (§ 8 Abs. 1 Satz 2 Buchst. a i.V.m. § 20 TVAöD): <strong>30%</strong> Zuschlag. 
                        <span class="text-xs text-red-600 font-semibold block mt-1">
                            (Azubis werden für die Anwendung des § 8 Abs. 1 a) tariflich den Entgeltgruppen E1–E9 zugerechnet.)
                        </span>
                    </li>
                </ul>

                <h3 class="text-lg font-semibold mt-6">B. Kumulierung von Zeitzuschlägen (§ 8 Abs. 1 Satz 3 TVöD)</h3>
                <blockquote class="mt-2 p-3 rounded-r-lg border border-gray-200 bg-gray-50">
                    <strong class="font-bold text-red-700">Pro Stunde wird nur der höchste Zuschlag gezahlt.</strong>
                    <p class="mt-1 text-sm text-gray-700">Werden für eine Stunde mehrere Zeitzuschläge fällig (z.B. Nacht- und Sonntagszuschlag), wird pro Stunde nur der <strong>höchste</strong> zustehende Prozentsatz vergütet (z.B. Sonntag 25% > Nacht 20%). Sie addieren sich <strong>nicht</strong>.</p>
                </blockquote>

                <h3 class="text-lg font-semibold mt-6">C. Feste Schicht- und Wechselschichtzulage (Fixbeträge pro Stunde)</h3>
                <blockquote class="mt-2 p-3 rounded-r-lg border border-gray-200 bg-gray-50">
                    <p class="font-mono text-sm font-bold">
                        <!-- ANPASSUNG DER NENNUNG DER KORRIGIERTEN AZUBI-SÄTZE -->
                        <!-- Hier wird der Text auf 1,18 € aktualisiert -->
                        - Wechselschichtzulage (§ 8 Abs. 5): <strong>1,18 € pro Stunde</strong><br>
                        <!-- Hier wird der Text auf 0,59 € aktualisiert -->
                        - Schichtzulage (§ 8 Abs. 6): <strong>0,59 € pro Stunde</strong>
                    </p>
                    
                    <p class="text-sm text-gray-700 mt-4">
                        <strong>Hinweis zur Pauschale:</strong> Azubis, die <strong>ständig</strong> Schicht- oder Wechselschichtarbeit leisten, erhalten eine monatliche Pauschale. Für Azubis, die diese Kriterien nicht erfüllen, erfolgt die Zahlung <strong>stundenweise</strong> für die tatsächlich geleistete Zeit. 
                    </p>

                    <!-- KRITERIEN FÜR STÜNDLICHE ZULAGEN (KLARSTELLUNG) -->
                    <h4 class="text-sm font-bold text-gray-800 mt-3">Anspruchskriterien für die stündliche Zulage (Nicht-Ständig):</h4>
                    <ul class="list-disc list-inside text-sm text-gray-700 mt-1 ml-4 space-y-1">
                        <!-- Hier wird der Text auf 1,18 € aktualisiert -->
                        <li><strong>Wechselschichtzulage (1,18 €/h):</strong> Steht zu, wenn die Arbeit nach einem <strong>Wechselschichtplan</strong> erfolgt (regelmäßiger Wechsel von <strong>Tag</strong> und <strong>Nacht</strong> in ununterbrochenem 24/7-Betrieb). Die Zulage wird für jede Stunde in dieser Dienstplanform gezahlt. <strong>Achtung:</strong> Der Nachtdienst muss nur Teil des zugrunde liegenden Plans sein. <strong>Keine Mindeststunden pro Monat erforderlich.</strong></li>
                        <!-- Hier wird der Text auf 0,59 € aktualisiert -->
                        <li><strong>Schichtzulage (0,59 €/h):</strong> Steht nur dann zu, wenn die Wechselschichtzulage <strong>nicht</strong> zusteht, aber die Arbeit als <strong>Schichtarbeit</strong> definiert ist. Dies ist der Fall, wenn <strong>in Schichten gearbeitet wird</strong>, aber die Kriterien der Wechselschicht (der Nachtdienst-Anteil) <strong>fehlen</strong>. <strong>Keine Mindeststunden pro Monat erforderlich.</strong></li>
                    </ul>
                    <!-- ENDE KRITERIEN -->
                    
                    <h4 class="text-sm font-bold text-gray-800 mt-3 border-t pt-3 border-gray-300">
                        Addition und Unabhängigkeit 
                    </h4>
                    <p class="mt-1 text-sm text-gray-700">
                        Die festen Schichtzulagen (Wechselschichtzulage <strong>1,18 €/h</strong> oder Schichtzulage <strong>0,59 €/h</strong>) werden <strong>immer zusätzlich</strong> zu den prozentualen Zeitzuschlägen (§ 8 Abs. 1 TVöD, z.B. Sonntags- oder Nachtzuschlag) gezahlt. 
                        
                        Wichtig: Der Sonntagszuschlag (Abs. 1) wird durch die Schichtzulagen NICHT ausgeschlossen, sondern addiert sich dazu.
                        
                        <br>
                        <strong class="font-bold" style="color:red; margin-top:0.5rem; display:block;">Ausschlussprinzip:</strong> Nur die <strong>höhere</strong> Stundenzulage (Wechselschicht oder Schicht) darf pro Dienst geltend gemacht werden (Abs. 5 schließt Abs. 6 aus).
                    </p>
                </blockquote>
                
                <!-- Entgeltfortzahlung (2. § KORRIGIERT) -->
                <h3 class="text-lg font-semibold mt-6">D. Entgeltfortzahlung (Krankheit & Urlaub) – (<strong>§ 14 TVAöD-BBIG Abs. 2 Satz 1 / § 21 TVöD (VKA)</strong>)</h3>
                <blockquote class="mt-2 p-3 rounded-r-lg border border-gray-200 bg-gray-50">
                    <p class="text-sm text-gray-700">
                        Die Zulagen (§ 8 Abs. 1, 5, 6 TVöD) werden im <strong>Krankheitsfall</strong> (mit Entgeltfortzahlung) und bei der Berechnung des <strong>Urlaubsentgelts</strong> in Höhe des <strong>Durchschnitts der letzten drei vollen Kalendermonate</strong> fortgezahlt.
                    </p>
                    <p class="text-sm text-gray-700 mt-2">
                        Das bedeutet: Während Ihres Urlaubs oder bei Krankheit erhalten Sie zusätzlich zur Ausbildungsvergütung die durchschnittlich gezahlten Zeitzuschläge und Schichtzulagen, die Sie in den drei Monaten vor dem Ereignis erhalten haben. Der berechnete <strong>Monatsdurchschnitt</strong> unten dient als Schätzung für diesen Betrag.
                    </p>
                </blockquote>
                
                <!-- 4. NEU: Jahressonderzahlung (Punkt E) - ZURÜCK ZUR NEUTRALEN FARBE (Grau) -->
                <h3 class="text-lg font-semibold mt-6">E. Jahressonderzahlung (Weihnachtsgeld) – (<strong>§ 14 TVAöD-BBIG Abs. 1 Satz 1, 2</strong>)</h3>
                <blockquote class="mt-2 p-3 rounded-r-lg border border-gray-200 bg-gray-50">
                    <p class="text-sm text-gray-700 font-medium">
                        Auszubildenden steht eine Jahressonderzahlung zu. Sie wird in Höhe von <strong>90 v. H. des November-Ausbildungsentgelts</strong> gezahlt.
                    </p>
                    <p class="text-sm text-gray-700 mt-2">
                        Die Auszahlung erfolgt in der Regel mit dem November-Entgelt. Bei einer Ausbildungsvergütung von 1.200 € im November beträgt die Sonderzahlung beispielsweise 1.080 €.
                    </p>
                </blockquote>
                
                 <!-- 5. NEU: Abschlussprämie (Punkt F) - FARBE ANGEPASST (Grau-50/200) -->
                <h3 class="text-lg font-semibold mt-6">F. Abschlussprämie bei bestandener Prüfung – (<strong>§ 17 TVAöD-BBIG Abs. 1 Satz 1</strong>)</h3>
                <blockquote class="mt-2 p-3 rounded-r-lg border border-gray-200 bg-gray-50">
                    <p class="text-sm text-gray-700 font-medium">
                        Bei erfolgreich bestandener Abschlussprüfung haben Auszubildende Anspruch auf eine einmalige Prämie in Höhe von <strong>400 Euro</strong>.
                    </p>
                </blockquote>

                <!-- 6. NEU: Probezeit und VWL (Punkt G) - ZURÜCK ZUR NEUTRALEN FARBE (Grau) -->
                <h3 class="text-lg font-semibold mt-6">G. Probezeit und Vermögenswirksame Leistungen (VWL)</h3>
                <blockquote class="mt-2 p-3 rounded-r-lg border border-gray-200 bg-gray-50">
                    <ul class="list-disc list-inside text-sm text-gray-700 ml-4 space-y-2">
                        <li><strong>Probezeit:</strong> Die Probezeit beträgt maximal <strong>drei Monate</strong> (<strong>§ 3 TVAöD-BBIG Abs. 1</strong>).</li>
                        <li><strong>VWL:</strong> Auszubildenden stehen vermögenswirksame Leistungen in Höhe von monatlich <strong>13,29 Euro</strong> zu (<strong>§ 13 TVAöD-BBIG Abs. 1</strong>).</li>
                    </ul>
                </blockquote>
                
            </div>
        </section>

        <section id="calculator" class="card">
            <h2 class="text-2xl font-bold mb-6 text-center">Interaktiver Zulagen-Rechner</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                <div>
                    <h3 class="text-xl font-semibold mb-4">1. Grunddaten eingeben</h3>
                    <div class="space-y-4">
                        <div>
                            <label for="brutto" class="block text-sm font-medium text-gray-700">Monatsgehalt (Brutto) in €</label>
                            <input type="number" id="brutto" value="0" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div>
                            <label for="wochenstunden" class="block text-sm font-medium text-gray-700">Wochenarbeitszeit (Soll-Zeit)</label>
                            <input type="number" id="wochenstunden" value="0" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-700">Berechneter Stundenlohn:</p>
                            <p id="stundenlohn" class="text-lg font-bold text-indigo-600">0,00 €</p>
                        </div>
                    </div>

                    <h3 class="text-xl font-semibold mb-4 mt-8">2. Dienststunden-Rechner (Optional)</h3>
                    <div class="p-3 bg-indigo-50 border-l-4 border-indigo-500 text-indigo-800 text-sm rounded-r-lg mb-6">
                        Tragen Sie Ihre Dienstzahl und die <strong>zulagenberechtigten Stunden pro Dienst</strong> ein, um die <strong>Gesamtstunden</strong> für die Zeitzuschläge zu erhalten.
                    </div>
                    <div class="grid grid-cols-3 gap-4">
                         <div>
                            <label for="dienst_anzahl" class="block text-sm font-medium text-gray-700">Anzahl der Dienste</label>
                            <input type="number" id="dienst_anzahl" value="0" class="calc-input mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm">
                        </div>
                         <div>
                            <label for="stunden_pro_dienst" class="block text-sm font-medium text-gray-700">Stunden pro Dienst</label>
                            <input type="number" id="stunden_pro_dienst" value="0" class="calc-input mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div class="flex flex-col justify-end">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Gesamt-Dienststunden:</label>
                            <p id="gesamt_dienststunden" class="text-lg font-bold text-indigo-600">0 Stunden</p>
                        </div>
                    </div>
                    
                    <h3 class="xl font-semibold mb-4 mt-8 border-t pt-4 border-gray-200">3. Berechnung der Zulagen und Beträge</h3>
                    <div class="p-3 bg-blue-50 border-l-4 border-blue-500 text-blue-800 text-sm rounded-r-lg mb-6">
                        <strong>Wichtig: Splitten Sie Dienste!</strong> Tragen Sie hier <strong>Gesamtstunden</strong> ein, die <strong>tatsächlich</strong> den jeweiligen höchsten Zuschlag erhalten haben (Kumulierungsregel beachten).
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <!-- Feiertagszulage (135%): Höchste Priorität -->
                            <label for="feiertage_stunden" class="block text-sm font-medium text-gray-700">
                                Feiertage (135%, 00-24 Uhr) – <strong>Gesamtstunden</strong>:
                            </label>
                            <input type="number" id="feiertage_stunden" value="0" class="data-input mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <!-- Sonntagszulage (25%): Mittlere Priorität -->
                            <label for="sonntage_stunden" class="block text-sm font-medium text-gray-700">
                                Sonntage (25%, 00-24 Uhr) – <strong>Gesamtstunden</strong>:
                            </label>
                            <input type="number" id="sonntage_stunden" value="0" class="data-input mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                             <!-- Vorfeiertagszulage (35%): Hohe Priorität am 24./31.12. -->
                            <label for="vorfeiertag_stunden" class="block text-sm font-medium text-gray-700">
                                Vorfeiertage (35% ab 06:00 Uhr) – <strong>Gesamtstunden</strong>:
                            </label>
                            <input type="number" id="vorfeiertag_stunden" value="0" class="data-input mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <!-- Reine Nachtdienste (20%): Geringste Priorität, nur werktags zählen -->
                            <label for="nachtdienste_stunden" class="block text-sm font-medium text-gray-700">
                                Nachtdienste (20%, 21-06 Uhr) – <strong>Gesamtstunden</strong>:
                            </label>
                            <input type="number" id="nachtdienste_stunden" value="0" class="data-input mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label for="ueberstunden" class="block text-sm font-medium text-gray-700">Geleistete Überstunden gesamt (<strong>Stunden</strong>)</label>
                            <input type="number" id="ueberstunden" value="0" class="data-input mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm">
                        </div>
                        <!-- Feld für Samstage entfernt -->
                    </div>

                    <h4 class="text-lg font-bold mt-8 mb-4 border-t pt-4 border-gray-200">Feste Schichtzulagen</h4>
                    <p class="text-sm text-gray-600 mb-4">Hier tragen Sie die <strong>Anzahl der Dienste</strong> ein. Für die Berechnung der Zulage wird eine Dauer von <strong>12 Stunden pro Dienst</strong> angenommen.(<strong>1,18 €/h</strong> und <strong>0,59 €/h</strong>)</p>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="schicht" class="block text-sm font-medium text-gray-700">
                                <!-- KORRIGIERT AUF NEUEN SATZ 0,59 €/h -->
                                Schichtdienste (<strong>0,59 €/h</strong>) – <strong>Anzahl Dienste</strong>:
                            </label>
                            <input type="number" id="schicht" value="0" class="data-input mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label for="wechselschicht" class="block text-sm font-medium text-gray-700">
                                <!-- KORRIGIERT AUF NEUEN SATZ 1,18 €/h -->
                                Wechselschichtdienste (<strong>1,18 €/h</strong>) – <strong>Anzahl Dienste</strong>:
                            </label>
                            <input type="number" id="wechselschicht" value="0" class="data-input mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm">
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="xl font-semibold mb-4">4. Analyse der Nachzahlung und Durchschnitte</h3>
                    
                    <div id="results-zeitzuschlaege" class="space-y-2 p-4 result-highlight mb-4">
                        <h4 class="font-bold text-lg result-highlight-text">Zeitzuschläge und Überstunden (Prozentualer Satz)</h4>
                        <!-- Ergebnisse werden nach Berechnung hier eingefügt -->
                    </div>

                    <div id="results-new-rates" class="result-highlight">
                        <h4 class="font-bold text-lg result-highlight-text mb-2">Feste Schichtzulagen</h4>
                        <div id="new-rates-details"></div>
                        <div class="mt-2 pt-2 border-t border-green-300">
                            <span class="text-sm">Schichtzulage Gesamt:</span> 
                            <strong id="total-shift" class="text-base font-bold result-highlight-text">0,00 €</strong>
                        </div>
                    </div>
                    
                    <!-- Jährliche Gesamtforderung -->
                    <div class="mt-4 p-4 total-highlight">
                        <p class="text-lg font-semibold text-red-800">Gesamtforderung (Alle Komponenten):</p>
                        <p id="total" class="text-3xl font-bold text-red-900">0,00 €</p>
                    </div>

                    <!-- 5. Monatlicher Durchschnitt (§ KORRIGIERT) -->
                    <div id="average-allowance-section" class="p-4 bg-orange-100 border-l-4 border-orange-500 rounded-r-lg mt-4">
                        <h4 class="font-bold text-lg text-orange-800">5. Monatlicher Durchschnitt (§ 14 TVAöD-BBIG Abs. 2 Satz 1)</h4>
                        <p class="text-sm text-orange-800 mb-2">Geschätzter monatlicher Durchschnitt der Zulagen (3-Monats-Schnitt) für Entgeltfortzahlung bei Krankheit oder Urlaub:</p>
                        <strong id="monthly-average-allowance" class="text-2xl font-bold text-orange-900">0,00 €</strong>
                    </div>

                    <div class="mt-4 p-3 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 text-sm rounded-r-lg">
                        Hinweis zur Gesamtsumme: Die Gesamtforderung summiert alle Zeitzuschläge (<strong>Stunden-basiert</strong>), die Überstundenvergütung und die festen Schichtzulagen (<strong>Dienst-basiert</strong>). Für die Berechnung der prozentualen Zuschläge müssen <strong>Monatsgehalt</strong> und <strong>Wochenarbeitszeit</strong> eingetragen sein.
                    </div>
                </div>
            </div>
             <div class="mt-8">
                <h3 class="text-xl font-semibold mb-4 text-center">Visuelle Aufschlüsselung der Nachzahlung</h3>
                <div class="chart-container">
                    <canvas id="zulagenChart"></canvas>
                </div>
            </div>
        </section>

        <footer class="text-center mt-10 text-sm text-gray-500">
            <p>Dieses Tool dient der Veranschaulichung und stellt keine rechtsverbindliche Beratung dar. Alle Berechnungen sind Schätzungen basierend auf den eingegebenen Daten und der Interpretation des TVöD. Irrtümer vorbehalten.</p>
        </footer>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const inputs = document.querySelectorAll('#brutto, #wochenstunden, .data-input');
            const calcInputs = document.querySelectorAll('.calc-input');
            const stundenlohnEl = document.getElementById('stundenlohn');
            const gesamtDienststundenEl = document.getElementById('gesamt_dienststunden');
            const resultsZeitzuschlaegeEl = document.getElementById('results-zeitzuschlaege');
            const newRatesDetailsEl = document.getElementById('results-new-rates');
            const totalEl = document.getElementById('total');
            const totalShiftEl = document.getElementById('total-shift');
            
            const monthlyAverageAllowanceEl = document.getElementById('monthly-average-allowance');

            // Setzt alle Ausgabefelder auf 0,00 € beim Laden (Initialzustand)
            stundenlohnEl.textContent = '0,00 €';
            gesamtDienststundenEl.textContent = '0 Stunden';
            totalShiftEl.textContent = '0,00 €';
            monthlyAverageAllowanceEl.textContent = '0,00 €'; 
            totalEl.textContent = '0,00 €';
            
            // Initialer Inhalt der Ergebnisbereiche (Titel für Zeitzuschläge wird hier nur beim Laden gesetzt)
             resultsZeitzuschlaegeEl.innerHTML = `
                <h4 class="font-bold text-lg result-highlight-text">Zeitzuschläge und Überstunden (Prozentualer Satz)</h4>
            `;
            
            let chartInstance = null;
            const ctx = document.getElementById('zulagenChart').getContext('2d');
            
            // Funktion zur Diagrammerstellung/-aktualisierung
            function createOrUpdateChart(labels, data) {
                // Wenn die Gesamtsumme 0 ist, zeige kein Diagramm.
                const totalSum = data.reduce((a, b) => a + b, 0);
                if (totalSum === 0) {
                     if (chartInstance) {
                        chartInstance.destroy();
                        chartInstance = null;
                    }
                    return;
                }
                
                if (chartInstance) {
                    chartInstance.data.labels = labels;
                    chartInstance.data.datasets[0].data = data;
                    chartInstance.update();
                } else {
                    chartInstance = new Chart(ctx, {
                        type: 'pie', // AUF 'pie' UMGESTELLT
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Anteil der Zulage',
                                data: data,
                                backgroundColor: [
                                    'rgba(255, 99, 132, 0.7)', // Feiertag
                                    'rgba(54, 162, 235, 0.7)', // Sonntag
                                    'rgba(255, 206, 86, 0.7)', // Vorfeiertag
                                    'rgba(75, 192, 192, 0.7)', // Nacht
                                    'rgba(153, 102, 255, 0.7)', // Feste Schichtzulagen
                                    'rgba(255, 159, 64, 0.7)'  // Überstunden
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { 
                                    display: true, // Legende anzeigen
                                    position: 'right', // Legende rechts platzieren
                                }, 
                                tooltip: {
                                     callbacks: {
                                        // Tooltip-Callback für Kuchendiagramm: Zeigt Label, Währung und Prozent
                                        label: function(context) {
                                            const label = context.label || '';
                                            const value = context.parsed;
                                            
                                            // Gesamtsumme aller Werte im Datensatz
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : '0.0';
                                            
                                            // Währungsformatierung
                                            const currency = new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }).format(value);
                                            
                                            return `${label}: ${currency} (${percentage}%)`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }

            // Funktion: Berechnung der Gesamt-Dienststunden (Punkt 2)
            function calculateServiceHours() {
                const anzahl = parseFloat(document.getElementById('dienst_anzahl').value) || 0;
                const stunden = parseFloat(document.getElementById('stunden_pro_dienst').value) || 0;
                const totalHours = anzahl * stunden;
                
                gesamtDienststundenEl.textContent = totalHours.toFixed(0) + ' Stunden';
                calculate(); // Gesamtkalkulation neu starten
            }
            
            function calculate() {
                const brutto = parseFloat(document.getElementById('brutto').value) || 0;
                const wochenstunden = parseFloat(document.getElementById('wochenstunden').value) || 0;
                const wochenImMonat = 52 / 12;

                // Stundenlohn Berechnung
                const monatsstunden = wochenstunden * wochenImMonat;
                const stundenlohn = monatsstunden > 0 ? brutto / monatsstunden : 0;
                
                stundenlohnEl.textContent = stundenlohn.toFixed(2).replace('.', ',') + ' €';

                // 3. Zulagen-Input (Stunden-basiert)
                const sonntageStunden = parseFloat(document.getElementById('sonntage_stunden').value) || 0;
                const feiertageStunden = parseFloat(document.getElementById('feiertage_stunden').value) || 0;
                const vorfeiertagStunden = parseFloat(document.getElementById('vorfeiertag_stunden').value) || 0;
                const nachtdiensteStunden = parseFloat(document.getElementById('nachtdienste_stunden').value) || 0;
                const ueberstunden = parseFloat(document.getElementById('ueberstunden').value) || 0;
                
                // Feste Zulagen (Dienst-basiert)
                const schichtDienste = parseInt(document.getElementById('schicht').value) || 0;
                const wechselschichtDienste = parseInt(document.getElementById('wechselschicht').value) || 0;
                
                // NEU: Feste 12 Stunden pro Dienst für die Schichtzulage (unabhängig von Punkt 2)
                const FIXED_SHIFT_HOURS = 12;

                // --- 1. Zeitzuschläge (Prozentual) Berechnung ---
                // § 8 Abs. 1 TVöD
                const feiertagsZulage = feiertageStunden * (stundenlohn * 1.35); // 135% (Buchst. f)
                const sonntagsZulage = sonntageStunden * (stundenlohn * 0.25); // 25% (Buchst. d)
                const vorfeiertagsZulage = vorfeiertagStunden * (stundenlohn * 0.35); // 35% (Buchst. e)
                const nachtsZulage = nachtdiensteStunden * (stundenlohn * 0.20); // 20% (Buchst. b)
                
                const zeitzuschlaegeTotal = sonntagsZulage + feiertagsZulage + vorfeiertagsZulage + nachtsZulage;


                // --- 2. Überstundenvergütung ---
                // Überstundenzuschlag: § 8 Abs. 1 Satz 2 Buchst. a (30%) + Grundlohn (100%) = 130%
                const ueberstundenSatz = 1.30; 
                const ueberstundenTotal = ueberstunden * stundenlohn * ueberstundenSatz;

                // --- 3. Feste Schicht- und Wechselschichtzulagen (Fixbeträge) ---
                // KORRIGIERTE AZUBI-SÄTZE AUF KUNDENWUNSCH (1,18 € und 0,59 €)
                const schichtZulageBetrag = 0.59; // NEU: 0,59 €/h 
                const wechselschichtZulageBetrag = 1.18; // NEU: 1,18 €/h 

                // Berechnung der tatsächlichen Stunden für die Zulage, jetzt basierend auf 12 Stunden/Dienst
                const schichtStunden = schichtDienste * FIXED_SHIFT_HOURS;
                const wechselschichtStunden = wechselschichtDienste * FIXED_SHIFT_HOURS;

                const schichtZulage = schichtStunden * schichtZulageBetrag;
                const wechselschichtZulage = wechselschichtStunden * wechselschichtZulageBetrag;

                const schichtZulageTotal = schichtZulage + wechselschichtZulage;
                
                // --- Gesamtsummen ---
                // Zeitzuschläge und Schichtzulagen für Durchschnittsberechnung (§ 14 TVAöD-BBIG Abs. 2 Satz 1)
                const totalYearlyAllowances = zeitzuschlaegeTotal + schichtZulageTotal;
                // Gesamtforderung = Zulagen + Überstundenvergütung (Grundlohn + Zuschlag)
                const totalMax = totalYearlyAllowances + ueberstundenTotal; 

                // --- 5. Monatlicher Durchschnitt (§ 14 TVAöD-BBIG Abs. 2 Satz 1) ---
                const monthlyAverageAllowance = totalYearlyAllowances / 12;
                
                // --- HTML Ausgabe (Punkt 4 & 5) ---

                // Zeitzuschläge und Überstunden (Prozentualer Satz)
                resultsZeitzuschlaegeEl.innerHTML = `
                    <h4 class="font-bold text-lg result-highlight-text">Zeitzuschläge und Überstunden (Prozentualer Satz)</h4>
                    
                    ${generateResultLineAlwaysVisible('Feiertagszulage (135%)', feiertagsZulage, 'text-gray-700', feiertageStunden)} 

                    ${generateResultLineAlwaysVisible('Sonntagszulage (25%)', sonntagsZulage, 'text-gray-700', sonntageStunden)}
                    ${generateResultLineAlwaysVisible('Vorfeiertagszulage (35%)', vorfeiertagsZulage, 'text-gray-700', vorfeiertagStunden)}
                    ${generateResultLineAlwaysVisible('Nachtarbeitszulage (20%)', nachtsZulage, 'text-gray-700', nachtdiensteStunden)}
                    <div class="mt-2 pt-2 border-t border-gray-300">
                        ${generateResultLineAlwaysVisible('Überstunden (Grundlohn + 30% Zulage)', ueberstundenTotal, 'text-gray-700', ueberstunden)}
                    </div>
                `;

                // Feste Schichtzulagen
                // Da newRatesDetailsEl der gesamte Block ist, müssen wir nur den Inhalt aktualisieren, 
                // nicht den gesamten Block neu schreiben, da sonst der Titel weg wäre.
                const newRatesContent = document.querySelector('#results-new-rates #new-rates-details');
                if (newRatesContent) {
                    newRatesContent.innerHTML = `
                        <!-- KORRIGIERT AUF NEUEN SATZ 1,18 €/h -->
                        ${generateResultLineAlwaysVisible('Wechselschichtzulage (1,18 €/h)', wechselschichtZulage, 'result-highlight-text font-bold', wechselschichtDienste, ' Dienste', wechselschichtStunden)}
                        <!-- KORRIGIERT AUF NEUEN SATZ 0,59 €/h -->
                        ${generateResultLineAlwaysVisible('Schichtzulage (0,59 €/h)', schichtZulage, 'text-gray-600', schichtDienste, ' Dienste', schichtStunden)}
                    `;
                }

                totalShiftEl.textContent = schichtZulageTotal.toFixed(2).replace('.', ',') + ' €';

                // 5. Monatlicher Durchschnitt
                monthlyAverageAllowanceEl.textContent = monthlyAverageAllowance.toFixed(2).replace('.', ',') + ' €';

                // Gesamt
                totalEl.textContent = totalMax.toFixed(2).replace('.', ',') + ' €';

                // Chart Daten
                // Aktualisiere die Beschriftungen für die festen Zulagen
                const chartLabels = ['Feiertag (135%)', 'Sonntag (25%)', 'Vorfeiertag (35%)', 'Nacht (20%)', 'Feste Schichtzulagen (1,18/0,59 €/h)', 'Überstunden (130%)'];
                const chartData = [feiertagsZulage, sonntagsZulage, vorfeiertagsZulage, nachtsZulage, schichtZulageTotal, ueberstundenTotal];
                
                // Aktualisiere das Chart
                createOrUpdateChart(chartLabels, chartData);
            }
            
            // Hilfsfunktion: Zeigt das Ergebnis immer an (auch wenn Wert 0,00 € ist), blendet nur bei negativen Werten aus.
            function generateResultLineAlwaysVisible(label, value, extraClass = '', inputCount = null, unit = ' Std.', totalHours = null) {
                // Nur bei negativen Werten ausblenden. 0,00 € wird angezeigt.
                if (value < 0) { 
                    return '';
                }
                
                const formattedValue = value.toFixed(2).replace('.', ',');
                
                let countText = '';
                if (inputCount !== null && inputCount > 0) {
                    if (unit === ' Std.') {
                         // Zeitzuschläge und Überstunden (mit Dezimalstellen, falls eingegeben)
                         countText = ` (${inputCount}${unit})`;
                    } else if (unit === ' Dienste' && totalHours !== null) {
                         // Feste Schichtzulagen (Anzahl Dienste wird als ganze Zahl angezeigt, Stunden als Approximation)
                         countText = ` (${inputCount.toFixed(0)}${unit} ≈ ${totalHours.toFixed(0)} Std.)`;
                    }
                }
                
                return `
                    <div class="flex justify-between items-center text-sm ${extraClass}">
                        <span class="text-gray-600"><strong>${label}</strong>:</span>
                        <span class="font-semibold">${formattedValue} €${countText}</span>
                    </div>
                `;
            }

            // Initialisierung und Event Listener
            inputs.forEach(input => input.addEventListener('input', calculate));
            calcInputs.forEach(input => input.addEventListener('input', calculateServiceHours));
            
            // Initialberechnung beim Laden (sollte 0,00 € ergeben)
            calculateServiceHours(); 
        });
    </script>
</body>
</html>
